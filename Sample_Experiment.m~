function Sample_Experiment(subNo, condition)
                      
%The sign meaning experiment, Feb 2014
%                         
%subNo, the subject number to run. Subject code above
%99 is for testing; data overwrite will not be checked.
%
%
%condition, one of 6 set lists of items, specify 1-6
% 1= MannerOfMotionCondition
% 2= MannerOfMotionCondition_Instrumental
% 3= PathCondition
% 4= PathCondition_Instrumental
% 5= EffectCondition
% 6= MeansCondition
%
%
%
%Note: Make sure that you add the helper functions to the path, otherwise
%it won't work. You can do this by clicking on the folder helper functions
% -> add to path.

addpath('HelperFunctions')

%%%%%%%%%%%%%%%%%%%%%%%%%
% Preliminary stuff
%%%%%%%%%%%%%%%%%%%%%%%%%

global parameters

% File handling - makes the file where data will be stored
parameters.datafilepointer = AssignDataFile('SampleExp',subNo);

try %everything goes inside a 'try' block, so if it crashes, it crashes 
    %cleanly (and maybe even tells us what went wrong)
    
    disp('Hey!')
    
    %%%%%%%%%%%%%%%%%%%%%%
    % Parameter Setting
    %%%%%%%%%%%%%%%%%%%%%%
    
    % PsychTool setup
     Setup_PTool();
     SetParameters();
      
    % Sets specific values for this participant
    parameters.subNo = subNo;

    %%%%%%%%%%%%%%%%%%%%%%
    % Randomization of files, conditions, etc. goes here! An example is
    % below (Annemarie K.)
    %%%%%%%%%%%%%%%%%%%%%%  
%    
%    
%
%     %Read the file into matlab
%
% Note: ',' below depicts the delimeter in the csv file. Depending on the file, 
% this can either be ';' or ',' (or tab) (you can check this by printing the file,
% so without ; at the end of the line).
%
%
    vidNames = read_mixed_csv('Experiment_Items_final.csv',',')
%     
%                                             
%
%
%    %Routine to pick the specified signList (algebra to get us the right rows)
    
start_Index = (8*condition)-6;
end_Index = (8*condition)+1;


%     
%
%
%     %Turn list into vectors of variables
%
%
%
    parameters.Experiment = vidNames(start_Index:end_Index, 2)
    parameters.amyFileName = vidNames(start_Index:end_Index, 3)
    parameters.itemID = vidNames(start_Index:end_Index, 4)
    parameters.eventType = vidNames(start_Index:end_Index, 5)
    parameters.Condition = vidNames(start_Index:end_Index, 6)
    parameters.Manner = vidNames(start_Index:end_Index, 7)
    parameters.Path = vidNames(start_Index:end_Index, 8)
    parameters.verbName = vidNames(start_Index:end_Index, 9)
    parameters.verbMeaning = vidNames(start_Index:end_Index, 10)
    parameters.ambigS_not_recording = vidNames(start_Index:end_Index, 11)
    parameters.ambig_going_to = vidNames(start_Index:end_Index, 12)
    parameters.ambig_did_it = vidNames(start_Index:end_Index, 13)
    parameters.which_one = vidNames(start_Index:end_Index, 13)
    parameters.mbiasAns = vidNames(start_Index:end_Index, 12)                      
    parameters.pbiasAns = vidNames(start_Index:end_Index, 15)
    parameters.trainS1 = vidNames(start_Index:end_Index, 16)
    parameters.trainS2 = vidNames(start_Index:end_Index, 18)
    parameters.trainS3 = vidNames(start_Index:end_Index, 20)
    parameters.mTestAns = vidNames(start_Index:end_Index, 23)
    parameters.pTestAns = vidNames(start_Index:end_Index, 25)
    parameters.movieLenght = vidNames(start_Index:end_Index, 26)
    
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        
%     %Make video files (takes the video names from the .csv file)

    parameters.ambigV = vidNames(start_Index:end_Index, 14)
    parameters.mbiasV = vidNames(start_Index:end_Index, 12)
    parameters.pbiasV = vidNames(start_Index:end_Index, 14)
    parameters.trainV1 = vidNames(start_Index:end_Index, 17)
    parameters.trainV2 = vidNames(start_Index:end_Index, 19)
    parameters.trainV3 = vidNames(start_Index:end_Index, 21)
    parameters.mTest = vidNames(start_Index:end_Index, 22)
    parameters.pTest = vidNames(start_Index:end_Index, 24)
    parameters.LeftMovie = vidNames(start_Index:end_Index, 27)
    
%     
% %     %Now randomize everything (apply random order to all columns/objects)

    myRandOrder = randperm(8)                        
    parameters.amyFileName = parameters.amyFileName(myRandOrder)
    parameters.itemID = parameters.itemID(myRandOrder);
    parameters.eventType = parameters.eventType(myRandOrder);
    parameters.Condition = parameters.Condition(myRandOrder);
    parameters.Manner = parameters.Manner(myRandOrder);
    parameters.Path = parameters.Path(myRandOrder);
    parameters.verbName = parameters.verbName(myRandOrder);
    parameters.verbMeaning = parameters.verbMeaning(myRandOrder);
    parameters.ambigS_not_recording = parameters.ambigS_not_recording(myRandOrder);
    parameters.mbiasAns = parameters.mbiasAns(myRandOrder);
    parameters.pbiasAns = parameters.pbiasAns(myRandOrder);
    parameters.trainS1 = parameters.trainS1(myRandOrder);
    parameters.trainS2 = parameters.trainS2(myRandOrder);
    parameters.trainS3 = parameters.trainS3(myRandOrder);
    parameters.mTestAns = parameters.mTestAns(myRandOrder);
    parameters.pTestAns = parameters.pTestAns(myRandOrder);
    parameters.movieLenght = parameters.movieLenght(myRandOrder);
    parameters.ambigV = parameters.ambigV(myRandOrder);
    parameters.mbiasV = parameters.mbiasV(myRandOrder);
    parameters.pbias = parameters.pbias(myRandOrder);
    parameters.trainV1 = parameters.trainV1(myRandOrder);
    parameters.trainV2 = parameters.trainV2(myRandOrder);
    parameters.trainV3 = parameters.trainV3(myRandOrder);
    parameters.mTest = parameters.mTest(myRandOrder);
    parameters.pTest = parameters.pTest(myRandOrder);
    parameters.LeftMovie = parameters.LeftMovie(myRandOrder)
    
       
    %Randomize sides for target and distractor movies
    %parameters.LeftMovie = {'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'T', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D'}
    %newRand = randperm(1); %how many trials'
    %parameters.LeftMovie = parameters.LeftMovie(newRand);
    
    %%%%%%%%%%%%%%%%%%%%%%
    % Experiment
    %%%%%%%%%%%%%%%%%%%%%%

    %%%%%%%%%%%%%%%%%%%%%%
    % Prelim Screen/Instructions
    %%%%%%%%%%%%%%%%%%%%%%
    
     Text_Show('Press spacebar to start experiment.')
     Take_Response();    
    
     
  
         
     
     %Save a header file to the data file so it will be easier to read!
     WriteResultFile({'SubjectNo',...
         'trialNo',...
         'LeftMovie',...
         'Response'}); 
    
    %%%%%%%%%%%%%%%%%%%%%%
    % Trial Setup
    %%%%%%%%%%%%%%%%%%%%%%
    
    
    Text_Show('Ready? Press space to watch the movies.');
    response = Take_Response();
    %Want to finish early?
    if response == 'q'
        return
    end                                                                                                                                                                                                                                                                                                                                                                         
    
    
     
     %ntrials = length(parameters.pbias) %how many trials?

     ntrials = 1; %For the skeleton, play some short sample trials!


        
     for i=1:ntrials     
Text_Show('(((... is going to ...)))');
Take_Response();
Show_Blank;
                 
Play_Sound('feaving_manner_future_city.wav')



         Text_Show(char(parameters.ambigS_not_recording(i)));
         Take_Response();            
          response = Sample_Trial(i);  
         if response == 'q'                       
             break  

                                 
         end
         
         
         WriteResultFile({parameters.subNo, ...
             i, ...
             response}) %Note the curly brackets - this needs to be a cellarray of stuff you want to save
         
     end

    %%%%%%%%%%%%%%%%%%%%%%
    % Cleanup & Shutdown
    %%%%%%%%%%%%%%%%%%%%%%
    
     Closeout_PTool();
     
catch
    
    % Catch error: in case anything went wrong...
    % Do same cleanup as at the end of a regular session...
    Closeout_PTool();
    
    % Output the error message that describes the error:
    psychrethrow(psychlasterror);

end

end

